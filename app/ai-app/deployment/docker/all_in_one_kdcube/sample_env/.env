# =============================================================================
# KDCube AI Platform - Docker Compose Configuration
# =============================================================================
# This file contains build contexts, paths, and docker-compose variables.
# Copy this file and adjust paths for your environment.
#
# For runtime configuration (DB passwords, API keys), see:
#   .env.ingress / .env.proc / .env.metrics / .env.postgres.setup
# This stack runs local Postgres + Redis containers.
# =============================================================================

# -----------------------------------------------------------------------------
# DOCKER-IN-DOCKER PATH MAPPINGS
# -----------------------------------------------------------------------------
# Absolute paths on the host machine for volume mounts

# Path on host to mount as a KDCUBE STORAGE (local filesystem or S3).
# If using S3 in KDCUBE_STORAGE_PATH, not needed
HOST_KDCUBE_STORAGE_PATH=/absolute/path/to/deployment/docker/all_in_one_kdcube/data/kdcube-storage

# Host directory containing ALL custom agentic bundles (subfolders, wheels, zips)
# These extend the chat service with custom Python applications
HOST_BUNDLES_PATH=/absolute/path/to/bundles

# Temporary workspace for code execution (Docker-in-Docker)
HOST_EXEC_WORKSPACE_PATH=/absolute/path/to/deployment/docker/all_in_one_kdcube/data/exec-workspace

# Mount path for bundles inside the container
# DO NOT CHANGE unless you modify AGENTIC_BUNDLES_JSON references
AGENTIC_BUNDLES_ROOT=/bundles

# -----------------------------------------------------------------------------
# WEB UI BUILD CONFIGURATION
# -----------------------------------------------------------------------------
# Configuration for building the custom frontend application

# Root of frontend repository containing UI source code
# This works on Linux/Mac. For Windows, use a Windows-safe path (e.g., D:/path/to/customer-repo) and ensure Docker Desktop is configured to share that drive.
UI_BUILD_CONTEXT=/absolute/path/to/kdcube-ai-app

# Path to Dockerfile_UI (relative to UI_BUILD_CONTEXT)
UI_DOCKERFILE_PATH=app/ai-app/deployment/docker/all_in_one_kdcube/Dockerfile_UI

# Path to UI source code (relative to UI_BUILD_CONTEXT)
# This directory should contain package.json and your UI application
UI_SOURCE_PATH=src/ui/app

# Path to nginx configuration for UI (relative to UI_BUILD_CONTEXT)
# This configures how nginx serves your built UI application
NGINX_UI_CONFIG_FILE_PATH=ops/deployment/nginx_ui.conf

# This way we bind the frontend config.*.json when run frontend in docker
# Frontend env var which is responsible for url of this config called CHAT_WEB_APP_CONFIG_FILE_PATH and refers to RELATIVE, to frontend's public directory, path of the json config (its an url served by UI container's nginx /private/config.hardcoded.json)
PATH_TO_FRONTEND_CONFIG_JSON=app/ai-app/ui/chat-web-app/public/config.hardcoded.json

# -----------------------------------------------------------------------------
# PROXY BUILD CONFIGURATION
# -----------------------------------------------------------------------------
# Configuration for building the reverse proxy (nginx)

# Common parent directory that can reach both platform and frontend repos
# Example: If you have /src/platform-repo and /src/frontend-repo, use /src
# This setup is for KDCube platform and KDCube frontend
PROXY_BUILD_CONTEXT=/absolute/path/to/kdcube-ai-app

# Path to Dockerfile_Proxy (relative to PROXY_BUILD_CONTEXT)
# This Dockerfile is provided by the platform
PROXY_DOCKERFILE_PATH=app/ai-app/deployment/docker/all_in_one_kdcube/Dockerfile_Proxy

# Path to custom nginx proxy configuration (relative to PROXY_BUILD_CONTEXT)
# Use nginx/conf/nginx_proxy.conf for HTTP or nginx/conf/nginx_proxy_ssl.conf for HTTPS
NGINX_PROXY_CONFIG_FILE_PATH=app/ai-app/deployment/docker/all_in_one_kdcube/nginx/conf/nginx_proxy_ssl.conf

# -----------------------------------------------------------------------------
# NEO4J CONFIGURATION
# -----------------------------------------------------------------------------
# Neo4j database configuration (used by docker-compose for interpolation)

# Neo4j authentication
# N4J_USER=neo4j
# N4J_PASSWORD=changeme_neo4j_password

# Neo4j memory settings
# N4J_PAGECACHE=1G
# N4J_HEAP_INITIAL=512m
# N4J_HEAP_MAX=1G

# -----------------------------------------------------------------------------
# KDCube services. All scaled horizontally via running multiple instances of each service.
# -----------------------------------------------------------------------------
CHAT_APP_PORT=8010
CHAT_PROCESSOR_PORT=8020
METRICS_PORT=8090

# -----------------------------------------------------------------------------
# Local infra (Postgres + Redis containers)
# -----------------------------------------------------------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DATABASE=kdcube
POSTGRES_PORT=5432
POSTGRES_MAX_CONNECTIONS=200

# Optional aliases for tooling that expects PG* vars
PGUSER="${POSTGRES_USER}"
PGPASSWORD="${POSTGRES_PASSWORD}"
PGDATABASE="${POSTGRES_DATABASE}"

REDIS_PASSWORD=redispass
