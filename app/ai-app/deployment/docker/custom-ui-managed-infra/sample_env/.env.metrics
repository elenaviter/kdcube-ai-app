
# Metrics service (docker-compose)
METRICS_PORT=8090
METRICS_MODE=redis

# -------------- Service config ----------
# Required: Redis + shared gateway config (same JSON as ingress/proc).
# Managed Redis endpoint (reachable from containers)
REDIS_HOST="<REDIS_HOST>"
REDIS_PASSWORD="<REDIS_PASSWORD>"
REDIS_URL="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:6379/0"
# Example (readable, component-scoped):
# GATEWAY_CONFIG_JSON='{
#   "tenant": "<TENANT_ID>",
#   "project": "<PROJECT_ID>",
#   "profile": "development",
#   "service_capacity": {
#     "ingress": { "processes_per_instance": 2 },
#     "proc": {
#       "concurrent_requests_per_process": 8,
#       "processes_per_instance": 4,
#       "avg_processing_time_seconds": 25
#     }
#   },
#   "backpressure": {
#     "capacity_source_component": "proc",
#     "ingress": {
#       "capacity_buffer": 0.1,
#       "queue_depth_multiplier": 3,
#       "anonymous_pressure_threshold": 0.6,
#       "registered_pressure_threshold": 0.85,
#       "paid_pressure_threshold": 0.9,
#       "hard_limit_threshold": 0.98
#     },
#     "proc": {
#       "capacity_buffer": 0.1,
#       "queue_depth_multiplier": 3,
#       "anonymous_pressure_threshold": 0.6,
#       "registered_pressure_threshold": 0.85,
#       "paid_pressure_threshold": 0.9,
#       "hard_limit_threshold": 0.98
#     }
#   },
#   "rate_limits": {
#     "ingress": {
#       "anonymous": { "hourly": 120, "burst": 10, "burst_window": 60 },
#       "registered": { "hourly": 2000, "burst": 100, "burst_window": 60 },
#       "paid": { "hourly": 4000, "burst": 150, "burst_window": 60 },
#       "privileged": { "hourly": -1, "burst": 300, "burst_window": 60 }
#     },
#     "proc": {
#       "anonymous": { "hourly": 120, "burst": 10, "burst_window": 60 },
#       "registered": { "hourly": 2000, "burst": 100, "burst_window": 60 },
#       "paid": { "hourly": 4000, "burst": 150, "burst_window": 60 },
#       "privileged": { "hourly": -1, "burst": 300, "burst_window": 60 }
#     }
#   },
#   "pools": {
#     "ingress": { "pg_pool_min_size": 0, "pg_pool_max_size": 4, "redis_max_connections": 20 },
#     "proc": { "pg_pool_min_size": 0, "pg_pool_max_size": 8, "redis_max_connections": 40 },
#     "pg_max_connections": 100
#   },
#   "limits": {
#     "ingress": { "max_sse_connections_per_instance": 200 },
#     "proc": { "max_integrations_ops_concurrency": 200, "max_queue_size": 100 }
#   },
#   "redis": {
#     "sse_stats_ttl_seconds": 60,
#     "sse_stats_max_age_seconds": 120
#   }
# }'
GATEWAY_CONFIG_JSON=''
# -------------- Service config ----------

# Proxy mode only:
# METRICS_INGRESS_BASE_URL=http://chat-ingress:8010
# METRICS_PROC_BASE_URL=http://chat-proc:8020
METRICS_ENABLE_PG_POOL=0

# Auth header passed to upstream /monitoring/system (proxy mode only)
# METRICS_AUTH_HEADER_NAME=Authorization
# METRICS_AUTH_HEADER_VALUE=Bearer test-admin-token-123

# Scheduler/export
METRICS_SCHEDULER_ENABLED=1
METRICS_EXPORT_INTERVAL_SEC=30
METRICS_EXPORT_ON_START=1
# METRICS_RUN_ONCE=0

# Prometheus scrape cache TTL (seconds)
METRICS_PROM_SCRAPE_TTL_SEC=10

# Optional metric name mapping (affects CloudWatch + Prometheus names)
# METRICS_MAPPING_JSON={"ingress.sse.total_connections":{"name":"Ingress/SSEConnections","unit":"Count"}}

# CloudWatch export (optional)
METRICS_EXPORT_CLOUDWATCH=0
METRICS_CLOUDWATCH_NAMESPACE=KDCube/Metrics
# METRICS_CLOUDWATCH_REGION=eu-west-1
# METRICS_CLOUDWATCH_DIMENSIONS_JSON={"tenant":"<TENANT_ID>","project":"<PROJECT_ID>","env":"dev"}

# Prometheus pushgateway export (optional)
METRICS_EXPORT_PROMETHEUS_PUSH=0
# METRICS_PROM_PUSHGATEWAY_URL=http://pushgateway:9091
METRICS_PROM_JOB_NAME=kdcube_metrics
# METRICS_PROM_GROUPING_LABELS_JSON={"tenant":"<TENANT_ID>","project":"<PROJECT_ID>","env":"dev"}

# -------- AWS ----------
# One of these:
#
#  - Env keys
#      - AWS_ACCESS_KEY_ID
#      - AWS_SECRET_ACCESS_KEY
#      - optional AWS_SESSION_TOKEN
#  - Shared config
#      - AWS_SDK_LOAD_CONFIG=1
#      - AWS_PROFILE=<profile name>
#      - (and ~/.aws/credentials/config)

# On ECS/EC2 with IAM role:
#
#  AWS_REGION=eu-west-1
#  # make sure SDKs donâ€™t disable IMDS accidentally
#  AWS_EC2_METADATA_DISABLED=false
#  NO_PROXY=169.254.169.254,localhost,127.0.0.1
# -------- AWS ----------
