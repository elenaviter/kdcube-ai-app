DEFAULT_PROJECT_NAME="<PROJECT_NAME>"
DEFAULT_TENANT="<TENANT_ID>"
TENANT_ID="<TENANT_ID>"
POSTGRES_USER="<POSTGRES_USER>"
POSTGRES_PASSWORD="<POSTGRES_PASSWORD>"

POSTGRES_DATABASE=kdcube
POSTGRES_PORT=5432
POSTGRES_SSL=False

# For Postgres container
POSTGRES_DB="${POSTGRES_DATABASE}"
PGPORT="${POSTGRES_PORT}"

SELF_HOSTED_SERVING_ENDPOINT=http://localhost:5005

REDIS_PASSWORD="<REDIS_PASSWORD>"
REDIS_URL="redis://:${REDIS_PASSWORD}@redis:6379/0"
# Cap Redis connections per process (shared async + sync pools). Optional.
REDIS_MAX_CONNECTIONS=50

# Storage backend settings
# for s3, specify s3://bucket/path/to/store
# for local file system this path inside the docker will be used as KDCUBE storage path.
# docker-compose mounts it from HOST_KDCUBE_STORAGE_PATH (see .env)
KDCUBE_STORAGE_PATH=file:///kdcube-storage

ORCHESTRATOR_WORKER_CONCURRENCY=10
CB_ORCHESTRATOR_TYPE=chatbot
CB_RELAY_IDENTITY=kdcube.relay.chatbot

DRAMATIQ_PROCESSES=4
# Max queue size hard cap (0 = disabled). Enforced at enqueue time.
MAX_QUEUE_SIZE=100
# Per-task timeout (seconds).
CHAT_TASK_TIMEOUT_SEC=600

KB_PARALLELISM=4
# Gateway config override (recommended). Controls capacity + parallelism:
# - service_capacity.processes_per_instance = Uvicorn worker count per instance
# - service_capacity.concurrent_requests_per_process = max concurrent chat tasks per worker
# Example:
# GATEWAY_CONFIG_JSON='{"service_capacity":{"concurrent_requests_per_process":5,"processes_per_instance":4}}'
# Dev-only: enable auto-reload when running web_app.py directly (0/1).
UVICORN_RELOAD=0
HEARTBEAT_INTERVAL=5

# Ext services
OPENAI_API_KEY=sk-proj-...
HUGGING_FACE_API_TOKEN=hf_...
ANTHROPIC_API_KEY=sk-ant-...
BRAVE_API_KEY=...

GEMINI_CACHE_ENABLED=0
GEMINI_CACHE_TTL_SECONDS=3600

# Backend
# For CORS
APP_DOMAIN=your.domain.com

# Eval. Read by KB (PDF with Marker)
TORCH_DEVICE="cpu" # to force marker to use CPU

# OIDC settings
# Auth provider, simple|cognito
AUTH_PROVIDER=simple

# For non-simple auth, id token must be sent by client in addition to the access token in the auth header.
EXTRA_ID_TOKEN_HEADER=X-ID-Token

## Cognito specifics
COGNITO_REGION=eu-west-1
COGNITO_USER_POOL_ID="<COGNITO_USER_POOL_ID>"
COGNITO_APP_CLIENT_ID="<COGNITO_APP_CLIENT_ID>"
# ideally, separate client for service users. can be the same as COGNITO_APP_CLIENT_ID
COGNITO_SERVICE_CLIENT_ID="<COGNITO_SERVICE_APP_CLIENT_ID>"

# 24h JWKS cache. Not used
JWKS_CACHE_TTL_SECONDS=86400

## Service account settings
OIDC_SERVICE_ADMIN_USERNAME=service.user
OIDC_SERVICE_ADMIN_PASSWORD="<OIDC_SERVICE_ADMIN_PASSWORD>"
ODIC_SERVICE_USER_EMAIL=service@org.com

# Agentic bundles root inside the container. All bundles (subfolders, wheels, zips) will be linked there.
# The paths in the AGENTIC_BUNDLES_JSON must start with this root
AGENTIC_BUNDLES_ROOT=/bundles
# Host bundles root (used in docker-compose host mounts).
# Bundles cloned via git or manually provisioned on host should live under this path.
HOST_BUNDLES_PATH=/absolute/path/to/bundles

# App-side Neo4j connection settings (renamed from NEO4J_URI/NEO4J_USER/NEO4J_PASSWORD)
# APP_NEO4J_URI=bolt://neo4j:7687
# APP_NEO4J_USERNAME=neo4j
# APP_NEO4J_PASSWORD=neo4jpass123
# NEO4J_AUTH=neo4j/neo4jpass123

# Container-side tunables (safe names; used only for substitution)
# N4J_USER=neo4j
# N4J_PASSWORD=neo4jpass123
# N4J_PAGECACHE=1G
# N4J_HEAP_INITIAL=512m
# N4J_HEAP_MAX=1G

DEFAULT_LLM_MODEL_ID=sonnet-4.5
DEFAULT_EMBEDDING_MODEL_ID=openai-text-embedding-3-small

# SCAN
# 1 to enable, 0 to disable
APP_AV_SCAN=1
# scan timeout per file
APP_AV_TIMEOUT_S=3.0
CLAMAV_HOST=clamav
CLAMAV_PORT=3310

# use AWS from the container
AWS_REGION=eu-west-1
AWS_DEFAULT_REGION=eu-west-1

# --- EC2 stuff. If you rundockercompose on EC2.
# Running with managed services, see docker-compose-decentralized-infra-data.yaml
# don't proxy IMDS
NO_PROXY=169.254.169.254,localhost,127.0.0.1
# make sure SDKs donâ€™t disable IMDS accidentally
AWS_EC2_METADATA_DISABLED=false
# ---

# optional: make boto3 read ~/.aws/config if present (harmless)
AWS_SDK_LOAD_CONFIG=1

# tools
TOOLS_WEB_SEARCH_FETCH_CONTENT=True

# Web Fetch Resource Credentials
# Format: JSON with "cookies" object containing cookie key-value pairs

# Medium credentials (uid and sid from your browser after logging in.)
WEB_FETCH_RESOURCES_MEDIUM='{"cookies": {"uid": "699396d65560", "sid": "1:iw46p7En72P2RZ32i7zFxbXHDUJq0UjqxOxmZyjzJxbmQJYEfwo/igeLPitw2Afn"}}'
WEB_SEARCH_AGENTIC_THINKING_BUDGET=200

# Is adaptive (best effort graceful service degradation)
# backends supported: duckduckgo|brave|hybrid
WEB_SEARCH_PRIMARY_BACKEND=brave
WEB_SEARCH_BACKEND=hybrid

# # Hybrid mode (optional, defaults to "sequential"). sequential|parallel
WEB_SEARCH_HYBRID_MODE=sequential
WEB_SEARCH_SEGMENTER=fast

# Example for future sources (not implemented yet, but structure is ready)
# WEB_FETCH_RESOURCES_NYT='{"cookies": {"nyt-s": "YOUR_NYT_SESSION_HERE"}}'
# WEB_FETCH_RESOURCES_WSJ='{"cookies": {"wsjsession": "YOUR_WSJ_SESSION_HERE"}}'

# Analytics. Accounting events aggregation schedule
OPEX_AGG_CRON="0 23 * * *"
#
# Bundle cleanup / ref tracking
# Enable periodic bundle cleanup loop (uses Redis locks).
BUNDLE_CLEANUP_ENABLED=1
# Cleanup interval (seconds).
BUNDLE_CLEANUP_INTERVAL_SECONDS=3600
# Cleanup lock TTL (seconds).
BUNDLE_CLEANUP_LOCK_TTL_SECONDS=900
# Active bundle ref TTL (seconds).
BUNDLE_REF_TTL_SECONDS=3600

LOG_LEVEL=INFO
LOG_MAX_MB=20
LOG_BACKUP_COUNT=10
LOG_DIR=/logs
LOG_FILE_PREFIX=chat

PY_CODE_EXEC_IMAGE=py-code-exec:latest
PY_CODE_EXEC_TIMEOUT=600
PY_CODE_EXEC_NETWORK_MODE=host

ACCOUNTING_SERVICES='{"web_search": {"brave": {"tier": "free"}, "duckduckgo": {"tier": "free"}}}'

AUTH_TOKEN_COOKIE_NAME=__Secure-LATC
ID_TOKEN_COOKIE_NAME=__Secure-LITC

# mcp
MCP_CACHE_TTL_SECONDS=36000

INSTANCE_ID=my-kdcube-cb-instance-1

# to disable CORS - remove env var or set it empty
# all options are optional
# to enable CORS with all defaults CORS_CONFIG={}
CORS_CONFIG='{
    "allow_origins": [
        "http://localhost:3000",
        "http://localhost:3001",
        "http://localhost:4000",
        "http://localhost:5173",
        "http://localhost:5174",
        "http://localhost:8050",
        "http://localhost:5175"
    ],
    "allow_credentials":true,
    "allow_methods":"*",
    "allow_headers":"*"
}'
