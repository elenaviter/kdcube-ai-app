CHAT_PROCESSOR_PORT=8020
GATEWAY_COMPONENT=proc

# -------------- Service config ----------
# Gateway config (required). Must include tenant + project.
# Example (readable, component-scoped):
# GATEWAY_CONFIG_JSON='{
#   "tenant": "<TENANT_ID>",
#   "project": "<PROJECT_ID>",
#   "profile": "development",
#   "service_capacity": {
#     "ingress": { "processes_per_instance": 1 },
#     "proc": {
#       "concurrent_requests_per_process": 10,
#       "processes_per_instance": 1,
#       "avg_processing_time_seconds": 25
#     }
#   },
#   "backpressure": {
#     "capacity_source_component": "proc",
#     "ingress": {
#       "capacity_buffer": 0.1,
#       "queue_depth_multiplier": 3,
#       "anonymous_pressure_threshold": 0.6,
#       "registered_pressure_threshold": 0.85,
#       "paid_pressure_threshold": 0.9,
#       "hard_limit_threshold": 0.98
#     },
#     "proc": {
#       "capacity_buffer": 0.1,
#       "queue_depth_multiplier": 3,
#       "anonymous_pressure_threshold": 0.6,
#       "registered_pressure_threshold": 0.85,
#       "paid_pressure_threshold": 0.9,
#       "hard_limit_threshold": 0.98
#     }
#   },
#   "rate_limits": {
#     "ingress": {
#       "anonymous": { "hourly": 120, "burst": 10, "burst_window": 60 },
#       "registered": { "hourly": 2000, "burst": 100, "burst_window": 60 },
#       "paid": { "hourly": 4000, "burst": 150, "burst_window": 60 },
#       "privileged": { "hourly": -1, "burst": 300, "burst_window": 60 }
#     },
#     "proc": {
#       "anonymous": { "hourly": 120, "burst": 10, "burst_window": 60 },
#       "registered": { "hourly": 2000, "burst": 100, "burst_window": 60 },
#       "paid": { "hourly": 4000, "burst": 150, "burst_window": 60 },
#       "privileged": { "hourly": -1, "burst": 300, "burst_window": 60 }
#     }
#   },
#   "pools": {
#     "ingress": { "pg_pool_min_size": 0, "pg_pool_max_size": 4, "redis_max_connections": 20 },
#     "proc": { "pg_pool_min_size": 0, "pg_pool_max_size": 8, "redis_max_connections": 40 },
#     "pg_max_connections": 100
#   },
#   "limits": {
#     "ingress": { "max_sse_connections_per_instance": 200 },
#     "proc": { "max_integrations_ops_concurrency": 200, "max_queue_size": 100 }
#   },
#   "redis": {
#     "sse_stats_ttl_seconds": 60,
#     "sse_stats_max_age_seconds": 120
#   }
# }'
GATEWAY_CONFIG_JSON=''

POSTGRES_HOST="<POSTGRES_HOST>"
POSTGRES_PORT=5432
POSTGRES_DATABASE=kdcube
POSTGRES_USER="<POSTGRES_USER>"
POSTGRES_PASSWORD="<POSTGRES_PASSWORD>"

POSTGRES_SSL=False

# Local infra stack typically exposes Redis on localhost:6379
REDIS_HOST="<REDIS_HOST>"
REDIS_PASSWORD="<REDIS_PASSWORD>"
REDIS_URL="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:6379/0"

CB_RELAY_IDENTITY=kdcube.relay.chatbot

# Per-task timeout (seconds).
CHAT_TASK_TIMEOUT_SEC=600

# Dev-only: enable auto-reload when running web_app.py directly (0/1).
UVICORN_RELOAD=0
HEARTBEAT_INTERVAL=5
# -------------- Service config ----------

# --------------- Storage ----------------
# Storage backend settings
# for s3, specify s3://bucket/path/to/store
# for local file system this path inside the docker will be used as KDCUBE storage path.
# docker-compose mounts it from HOST_KDCUBE_STORAGE_PATH (see .env)
# For local dev (no container), use an absolute path on your machine or s3
KDCUBE_STORAGE_PATH=file:///absolute/path/to/kdcube-storage
CB_BUNDLE_STORAGE_URL=file:///absolute/path/to/kdcube-storage
# --------------- Storage ----------------

# --------------- Services credentials ----
# Ext services
OPENAI_API_KEY=sk-proj-...
HUGGING_FACE_API_TOKEN=hf_...
ANTHROPIC_API_KEY=sk-ant-...
BRAVE_API_KEY=...

GEMINI_CACHE_ENABLED=0
GEMINI_CACHE_TTL_SECONDS=3600
# --------------- Services credentials ----

DEFAULT_LLM_MODEL_ID=sonnet-4.5
DEFAULT_EMBEDDING_MODEL_ID=openai-text-embedding-3-small

# ----------- Auth ---------------------
# Auth provider, simple|cognito
#AUTH_PROVIDER=cognito
AUTH_PROVIDER=simple
# For non-simple auth, id token must be sent by client in addition to the access token in the auth header.
ID_TOKEN_HEADER_NAME=X-ID-Token

AUTH_TOKEN_COOKIE_NAME=__Secure-LATC
ID_TOKEN_COOKIE_NAME=__Secure-LITC

## Cognito specifics
COGNITO_REGION="<COGNITO_REGION>"
COGNITO_USER_POOL_ID="<COGNITO_USER_POOL_ID>"
COGNITO_APP_CLIENT_ID="<COGNITO_APP_CLIENT_ID>"
# ideally, separate client for service users. can be the same as COGNITO_APP_CLIENT_ID
COGNITO_SERVICE_CLIENT_ID="<COGNITO_SERVICE_APP_CLIENT_ID>"

# 24h JWKS cache. Not used
JWKS_CACHE_TTL_SECONDS=86400

## Service account settings
OIDC_SERVICE_ADMIN_USERNAME=service.user
OIDC_SERVICE_ADMIN_PASSWORD="<OIDC_SERVICE_ADMIN_PASSWORD>"
ODIC_SERVICE_USER_EMAIL=service@org.com
# --------- Auth ------------------

# ------------ Bundle -------------
# Bundles descriptor (owner: customer repo).
# Example:
# AGENTIC_BUNDLES_JSON='{
#   "default_bundle_id": "my-bundle@2.0.0",
#   "bundles": {
#     "my-bundle@2.0.0": {
#       "id": "my-bundle@2.0.0",
#       "name": "My Bundle",
#       "path": "/bundles/my-bundle@2.0.0",
#       "module": "my_bundle.entrypoint",
#       "git_url": "https://git.example.com/org/my-bundle.git",
#       "git_ref": "v2.0.0",
#       "git_subdir": "bundle"
#     }
#   }
# }'
AGENTIC_BUNDLES_JSON=''

# ---------- Exec --------------
EXEC_WORKSPACE_ROOT=/absolute/path/to/kdcube/exec-workspace

PY_CODE_EXEC_IMAGE=py-code-exec:latest
PY_CODE_EXEC_TIMEOUT=600
PY_CODE_EXEC_NETWORK_MODE=host
# ---------- Exec --------------

# ----------- Tools --------------
TOOLS_WEB_SEARCH_FETCH_CONTENT=True

# Web Fetch Resource Credentials
# Format: JSON with "cookies" object containing cookie key-value pairs

# Medium credentials (uid and sid from your browser after logging in.)
WEB_FETCH_RESOURCES_MEDIUM='{"cookies": {"uid": "699396d65560", "sid": "1:iw46p7En72P2RZ32i7zFxbXHDUJq0UjqxOxmZyjzJxbmQJYEfwo/igeLPitw2Afn"}}'
WEB_SEARCH_AGENTIC_THINKING_BUDGET=200

# Is adaptive (best effort graceful service degradation)
# backends supported: duckduckgo|brave|hybrid
WEB_SEARCH_PRIMARY_BACKEND=brave
WEB_SEARCH_BACKEND=hybrid

# # Hybrid mode (optional, defaults to "sequential"). sequential|parallel
WEB_SEARCH_HYBRID_MODE=sequential
WEB_SEARCH_SEGMENTER=fast

# Example for future sources (not implemented yet, but structure is ready)
# WEB_FETCH_RESOURCES_NYT='{"cookies": {"nyt-s": "YOUR_NYT_SESSION_HERE"}}'
# WEB_FETCH_RESOURCES_WSJ='{"cookies": {"wsjsession": "YOUR_WSJ_SESSION_HERE"}}'

MCP_CACHE_TTL_SECONDS=36000
# ----------- Tools --------------

ACCOUNTING_SERVICES='{"web_search": {"brave": {"tier": "free"}, "duckduckgo": {"tier": "free"}}}'

# Bundle cleanup / ref tracking
# Enable periodic bundle cleanup loop (uses Redis locks).
BUNDLE_CLEANUP_ENABLED=1
# Cleanup interval (seconds).
BUNDLE_CLEANUP_INTERVAL_SECONDS=3600
# Cleanup lock TTL (seconds).
BUNDLE_CLEANUP_LOCK_TTL_SECONDS=900
# Active bundle ref TTL (seconds).
BUNDLE_REF_TTL_SECONDS=3600

# Force bundles registry overwrite from env on startup (processor only).
BUNDLES_FORCE_ENV_ON_STARTUP=0
BUNDLES_FORCE_ENV_LOCK_TTL_SECONDS=60

# Disable git bundle resolution until git bundles are fully configured.
BUNDLE_GIT_RESOLUTION_ENABLED=0

# ---------- Log --------------
LOG_LEVEL=INFO
LOG_MAX_MB=20
LOG_BACKUP_COUNT=10
LOG_DIR=/kdcube/logs
LOG_FILE_PREFIX=chat-proc
# ---------- Log --------------

# -------- CORS -------
# APP_DOMAIN=your.domain.com

# to disable CORS - remove env var or set it empty
# all options are optional
# to enable CORS with all defaults CORS_CONFIG={}
CORS_CONFIG='{
    "allow_origins": [
        "http://localhost:3000",
        "http://localhost:3001",
        "http://localhost:4000",
        "http://localhost:5173",
        "http://localhost:5174",
        "http://localhost:8050",
        "http://localhost:5175"
    ],
    "allow_credentials":true,
    "allow_methods":"*",
    "allow_headers":"*"
}'
# -------- CORS -------

# -------- AWS -------------
# -------- use AWS from the container ------
# AWS_PROFILE=...
AWS_REGION=eu-west-1
AWS_DEFAULT_REGION=eu-west-1

# optional: make boto3 read ~/.aws/config if present (harmless)
AWS_SDK_LOAD_CONFIG=1

# --- EC2 stuff. If you run dockercompose on EC2.
# Running with managed services, see docker-compose-decentralized-infra-data.yaml
# don't proxy IMDS
NO_PROXY=169.254.169.254,localhost,127.0.0.1
# make sure SDKs donâ€™t disable IMDS accidentally
AWS_EC2_METADATA_DISABLED=false
# -------- AWS ----------
